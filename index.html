<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CuraLife - Medical Products</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

    <style>
        :root {
            --primary: #0c4a6e;
            --primary-light: #0891b2;
            --secondary: #059669;
            --accent: #dc2626;
            --text: #2d3748;
            --text-light: #64748b;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --border: #e5e7eb;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .site-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }
        
        .navigation {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .cart-count {
            position: relative;
        }
        
        .cart-count::after {
            content: attr(data-count);
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 50%;
            position: absolute;
            top: -8px;
            right: -5px;
            min-width: 20px;
            text-align: center;
        }
        
        /* Main Content Styles */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 15px;
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .product-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .product-desc {
            color: var(--text-light);
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary-light);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background: #047857;
        }
        
        /* Forms */
        .form-container {
            max-width: 500px;
            margin: 2rem auto;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
        }
        
        .error-message {
            color: #dc2626;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .success-message {
            background: #dcfce7;
            color: var(--secondary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--secondary);
        }
        
        /* Cart */
        .cart-items {
            margin-bottom: 2rem;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 1rem;
        }
        
        .cart-item-details {
            flex-grow: 1;
        }
        
        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .cart-item-price {
            color: var(--secondary);
            font-weight: 700;
        }
        
        .cart-item-remove {
            color: var(--accent);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .cart-summary {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .cart-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        /* Admin Panel */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .admin-table th {
            background: var(--primary-light);
            color: white;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background: #f1f5f9;
        }
        
        .status-pending {
            color: #d97706;
            font-weight: 600;
        }
        
        .status-confirmed {
            color: var(--secondary);
            font-weight: 600;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .navigation {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-container {
                grid-template-columns: 1fr;
            }
            
            .admin-table {
                font-size: 0.85rem;
            }
            
            .admin-table th,
            .admin-table td {
                padding: 0.5rem;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="site-title">CuraLife</h1>
            <div class="navigation">
                <a href="products.html" class="nav-link" data-view="products">Products</a>
                <a href="cart.html" class="nav-link cart-count" data-view="cart" data-count="0">Cart</a>
                <a href="login.html" class="nav-link" data-view="login" id="auth-link">Login</a>
                <a href="#admin" class="nav-link" data-view="admin" id="admin-link" style="display: none;">Admin</a>
            </div>
        </div>
    </header>


    <main>
        <section id="products-view" class="view active">
    <div class="hero">
        <h1>Quality Medical Products</h1>
        <p>Discover our range of healthcare essentials for your well-being</p>
        <button class="btn btn-success" onclick="window.location.href='products.html'">Shop Now</button>
    </div>

    <h2 style="text-align: center; margin-bottom: 2rem;">Our Products</h2>
    
    <div class="products-grid" id="products-grid">
    </div>
</section>

        <section id="login-view" class="view">
            <div class="form-container">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">Login to Your Account</h2>
                
                <div id="login-error" class="error-message" style="display: none;"></div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email or Username</label>
                        <input type="text" id="login-email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                
                <p style="text-align: center; margin-top: 1.5rem;">
                    Don't have an account? <a href="signup.html" onclick="showView('register')">Register here</a>
                </p>
            </div>
        </section>

        <section id="register-view" class="view">
            <div class="form-container">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">Create an Account</h2>
                
                <div id="register-error" class="error-message" style="display: none;"></div>
                <div id="register-success" class="success-message" style="display: none;"></div>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-confirm">Confirm Password</label>
                        <input type="password" id="register-confirm" class="form-control" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Register</button>
                </form>
                
                <p style="text-align: center; margin-top: 1.5rem;">
                    Already have an account? <a href="#login" onclick="showView('login')">Login here</a>
                </p>
            </div>
        </section>

        <section id="cart-view" class="view">
            <h2 style="text-align: center; margin-bottom: 2rem;">Your Shopping Cart</h2>
            
            <div id="empty-cart" style="text-align: center; display: none;">
                <p style="font-size: 1.2rem; margin-bottom: 1rem;">Your cart is empty</p>
                <button class="btn btn-primary" onclick="showView('products')">Continue Shopping</button>
            </div>
            
            <div id="cart-content" style="display: none;">
                <div class="cart-items" id="cart-items">
                    </div>
                
                <div class="cart-summary">
                    <div class="cart-total" id="cart-total">Total: â‚¹0</div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-primary" onclick="showView('products')">Continue Shopping</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="admin-view" class="view">
            <h2 style="text-align: center; margin-bottom: 2rem;">Admin Panel</h2>
            
            <div class="form-container">
                <h3 style="margin-bottom: 1rem;">Transaction Management</h3>
                
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>User</th>
                            <th>Email</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table">
                        <tr>
                            <td colspan="6" style="text-align: center;">No transactions found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        // Init Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCq4DizgVzK3zOOdh--tkmSqlgNtd2GteI",
            authDomain: "medishop-27098.firebaseapp.com",
            projectId: "medishop-27098",
            storageBucket: "medishop-27098.appspot.com",
            messagingSenderId: "880890490800",
            appId: "1:880890490800:web:d4c03c5cc83720ef723075",
            databaseURL: "https://medishop-27098-default-rtdb.firebaseio.com/"
          };

          firebase.initializeApp(firebaseConfig);
          const auth = firebase.auth();
          const db = firebase.database();
          
          // ðŸŸ¢ Replace Firestore "onSnapshot" with Realtime DB "on('value')"
          function renderTransactions() {
            const table = document.getElementById("transactions-table");
            const ref = db.ref("transactions");
            ref.on("value", snapshot => {
              table.innerHTML = "";
              const data = snapshot.val();
              if (!data) {
                table.innerHTML = `<tr><td colspan="6">No transactions found</td></tr>`;
                return;
              }
              Object.keys(data).forEach(key => {
                const t = data[key];
                const row = document.createElement("tr");
                row.innerHTML = `
                  <td>${t.transactionId}</td>
                  <td>${t.user}</td>
                  <td>${t.email}</td>
                  <td>â‚¹${t.total}</td>
                  <td class="status-${t.status.toLowerCase()}">${t.status}</td>
                  <td>
                    <button onclick="updateTransactionStatus('${key}', 'Confirmed')" class="btn">Confirm</button>
                    <button onclick="updateTransactionStatus('${key}', 'Pending')" class="btn">Set Pending</button>
                  </td>
                `;
                table.appendChild(row);
              });
            });
          }

          // ðŸŸ¢ Replace Firestore "updateDoc" with Realtime DB "set"
          function updateTransactionStatus(id, status) {
            db.ref("transactions/" + id + "/status").set(status);
          }


        const app = firebase.initializeApp(firebaseConfig);
        const authlink = firebase.auth();
        const dbLink = firebase.firestore();

        // --- ADDED: load client JSON configs and initialize Firebase (no UI changes) ---
        (function(){
            // Expose these globals for later use by your other scripts or for direct calls
            window.razorpayClient = null;
            window.firebaseApp = null;
            window.firebaseDb = null;

            // helper to fetch JSON safely
            async function fetchJson(path) {
                try {
                    const res = await fetch(path, {cache: "no-store"});
                    if (!res.ok) throw new Error('Fetch failed: ' + res.status);
                    return await res.json();
                } catch (err) {
                    console.warn('Could not load', path, err);
                    return null;
                }
            }

            // Load both configs in parallel
            Promise.all([
                fetchJson('/firebaseConfig.json'),
                fetchJson('/razorpayClient.json')
            ]).then(async ([fbConfig, rpClient]) => {
                // Store razorpay client config (may be null if file missing)
                window.razorpayClient = rpClient || null;

                // Initialize Firebase only if fbConfig is present
                if (fbConfig) {
                    try {
                        // Load firebase scripts dynamically (modular SDK)
                        const sdkUrl = 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
                        const firestoreUrl = 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
                        const appModule = await import(sdkUrl);
                        const firestoreModule = await import(firestoreUrl);

                        // initializeApp is exported as a named export; use dynamic import's namespace
                        const { initializeApp } = appModule;
                        const { getFirestore } = firestoreModule;

                        window.firebaseApp = initializeApp(fbConfig);
                        window.firebaseDb = getFirestore(window.firebaseApp);
                        console.log('Firebase initialized (client).');
                    } catch (e) {
                        console.warn('Failed to initialize Firebase SDK dynamically:', e);
                    }
                } else {
                    console.log('No firebaseConfig.json found â€” skipping Firebase init.');
                }

                // Make razorpayClient available and log warning if missing
                if (!window.razorpayClient || !window.razorpayClient.key_id) {
                    console.warn('razorpayClient.json not found or missing key_id. Create /razorpayClient.json with { "key_id": "rzp_test_..." }');
                } else {
                    console.log('Loaded razorpayClient key_id (client):', window.razorpayClient.key_id);
                }

                // Expose a small helper to get client configs synchronously later in other functions
                window.getClientConfig = () => ({ firebase: fbConfig, razorpay: window.razorpayClient });
            });
        })();
        // --- END ADDED SECTION ---

        // Sample product data
        const products = [
            {
                id: 1,
                name: "Digital Thermometer",
                description: "Accurate and fast temperature readings for all ages with easy-to-read display.",
                price: 299,
                image: "https://images.unsplash.com/photo-1588776814546-0a3a3a3a3a3a?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 2,
                name: "Blood Pressure Monitor",
                description: "Monitor your blood pressure easily at home with this reliable device.",
                price: 499,
                image: "https://images.unsplash.com/photo-1588776814547-1b4b4b4b4b4b?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 3,
                name: "Pulse Oximeter",
                description: "Check your oxygen saturation and pulse rate instantly with this portable device.",
                price: 799,
                image: "https://images.unsplash.com/photo-1588776814548-2c5c5c5c5c5c?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 4,
                name: "Glucometer Kit",
                description: "Manage your blood sugar levels with ease using this complete testing kit.",
                price: 999,
                image: "https://images.unsplash.com/photo-1588776814549-3d6d6d6d6d6d?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 5,
                name: "First Aid Kit",
                description: "Essential supplies for emergency medical care and minor injuries.",
                price: 1299,
                image: "https://images.unsplash.com/photo-1588776814550-4e7e7e7e7e7e?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 6,
                name: "Infrared Thermometer",
                description: "Non-contact temperature measurement for safety and convenience.",
                price: 699,
                image: "https://images.unsplash.com/photo-1588776814551-5f8f8f8f8f8f?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 7,
                name: "Stethoscope",
                description: "Professional-grade stethoscope for accurate auscultation and diagnosis.",
                price: 1499,
                image: "https://images.unsplash.com/photo-1588776814552-6g9g9g9g9g9g?auto=format&fit=crop&w=400&q=80"
            },
            {
                id: 8,
                name: "Nebulizer Machine",
                description: "Effective respiratory therapy for asthma and COPD patients.",
                price: 1999,
                image: "https://images.unsplash.com/photo-1588776814553-7h0h0h0h0h0h?auto=format&fit=crop&w=400&q=80"
            }
        ];

        // Sample transaction data
        const transactions = [
            {
                id: 1001,
                user: "John Doe",
                email: "john@example.com",
                total: 2297,
                status: "Pending",
                timestamp: "2023-06-15 14:30:22"
            },
            {
                id: 1002,
                user: "Jane Smith",
                email: "jane@example.com",
                total: 3497,
                status: "Confirmed",
                timestamp: "2023-06-14 10:15:45"
            },
            {
                id: 1003,
                user: "Guest",
                email: "guest@example.com",
                total: 999,
                status: "Pending",
                timestamp: "2023-06-13 16:45:30"
            }
        ];

        // Initialize cart if not exists
        if (!localStorage.getItem('cart')) {
            localStorage.setItem('cart', JSON.stringify({}));
        }

        // Initialize users if not exists
        if (!localStorage.getItem('users')) {
            // Default admin user (updated email to match CuraLife)
            const users = [
                {
                    id: 1,
                    username: 'admin',
                    email: 'admin@curalife.com',
                    password: 'admin123', // In a real app, this would be hashed
                    role: 'admin'
                }
            ];
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Get current user from session
        let currentUser = null;
        if (sessionStorage.getItem('currentUser')) {
            currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            updateAuthUI();
        }

        // Display products
        function renderProducts() {
            const productsGrid = document.getElementById('products-grid');
            productsGrid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <h3 class="product-name">${product.name}</h3>
                    <p class="product-desc">${product.description}</p>
                    <div class="product-price">â‚¹${product.price}</div>
                    <button class="btn btn-primary" onclick="addToCart(${product.id})">Add to Cart</button>
                `;
                productsGrid.appendChild(productCard);
            });
        }

        // Cart functionality
        function addToCart(productId) {
            const cart = JSON.parse(localStorage.getItem('cart'));
            if (cart[productId]) {
                cart[productId] += 1;
            } else {
                cart[productId] = 1;
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            
            // Show notification
            showNotification('Product added to cart!');
        }

        function logout() {
            auth.signOut().then(() => {
            window.location.href = "login.html";
            });
        }


        function removeFromCart(productId) {
            const cart = JSON.parse(localStorage.getItem('cart'));
            delete cart[productId];
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart'));
            const count = Object.values(cart).reduce((acc, val) => acc + val, 0);
            document.querySelector('.cart-count').setAttribute('data-count', count);
        }

        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('cart'));
            const cartItems = document.getElementById('cart-items');
            const emptyCart = document.getElementById('empty-cart');
            const cartContent = document.getElementById('cart-content');
            const cartTotal = document.getElementById('cart-total');
            
            cartItems.innerHTML = '';
            
            let total = 0;
            let hasItems = false;
            
            for (const productId in cart) {
                if (cart[productId] > 0) {
                    hasItems = true;
                    const product = products.find(p => p.id === parseInt(productId));
                    const quantity = cart[productId];
                    const itemTotal = product.price * quantity;
                    total += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="cart-item-image">
                        <div class="cart-item-details">
                            <div class="cart-item-name">${product.name}</div>
                            <div class="cart-item-price">â‚¹${product.price} x ${quantity} = â‚¹${itemTotal}</div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    cartItems.appendChild(cartItem);
                }
            }
            
            if (hasItems) {
                emptyCart.style.display = 'none';
                cartContent.style.display = 'block';
                cartTotal.textContent = `Total: â‚¹${total}`;
            } else {
                emptyCart.style.display = 'block';
                cartContent.style.display = 'none';
            }
            
            // Update order summary
            const orderSummary = document.getElementById('order-summary');
            orderSummary.innerHTML = '';
            
            for (const productId in cart) {
                if (cart[productId] > 0) {
                    const product = products.find(p => p.id === parseInt(productId));
                    const quantity = cart[productId];
                    const itemTotal = product.price * quantity;
                    
                    const itemElement = document.createElement('div');
                    itemElement.style.marginBottom = '0.5rem';
                    itemElement.innerHTML = `${product.name} x ${quantity}: â‚¹${itemTotal}`;
                    orderSummary.appendChild(itemElement);
                }
            }
            
            const totalElement = document.createElement('div');
            totalElement.style.marginTop = '1rem';
            totalElement.style.fontWeight = 'bold';
            totalElement.innerHTML = `Total: â‚¹${total}`;
            orderSummary.appendChild(totalElement);
        }

        // View management
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(`${viewName}-view`).classList.add('active');
            
            // Update URL hash
            window.location.hash = viewName;
            
            // Additional view-specific logic
            if (viewName === 'cart') {
                renderCart();
            } else if (viewName === 'admin') {
                renderTransactions();
            }
        }

        // Authentication
        function loginUser(email, password) {
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => 
                (u.email === email || u.username === email) && u.password === password
            );
            
            if (user) {
                // Remove password before storing in session
                const { password: _, ...userWithoutPassword } = user;
                sessionStorage.setItem('currentUser', JSON.stringify(userWithoutPassword));
                currentUser = userWithoutPassword;
                
                updateAuthUI();
                showView('products');
                return true;
            }
            
            return false;
        }

        function registerUser(username, email, password) {
            const users = JSON.parse(localStorage.getItem('users'));
            
            // Check if email already exists
            if (users.some(u => u.email === email)) {
                return { success: false, message: "Email already registered" };
            }
            
            // Check if username already exists
            if (users.some(u => u.username === username)) {
                return { success: false, message: "Username already taken" };
            }
            
            // Create new user
            const newUser = {
                id: users.length + 1,
                username,
                email,
                password, // In a real app, this would be hashed
                role: 'user'
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            return { success: true, message: "Registration successful" };
        }

        function logoutUser() {
            sessionStorage.removeItem('currentUser');
            currentUser = null;
            updateAuthUI();
            showView('products');
        }

        function updateAuthUI() {
            const authLink = document.getElementById('auth-link');
            const adminLink = document.getElementById('admin-link');
            
            if (currentUser) {
                authLink.textContent = 'Logout';
                authLink.onclick = logoutUser;
                
                if (currentUser.role === 'admin') {
                    adminLink.style.display = 'block';
                } else {
                    adminLink.style.display = 'none';
                }
            } else {
                authLink.textContent = 'Login';
                authLink.onclick = () => showView('login');
                adminLink.style.display = 'none';
            }
        }

        // Admin functionality
        function renderTransactions() {
            const transactionsTable = document.getElementById('transactions-table');
            transactionsTable.innerHTML = '';
            
            if (transactions.length === 0) {
                transactionsTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">No transactions found</td></tr>';
                return;
            }
            
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.id}</td>
                    <td>${transaction.user}</td>
                    <td>${transaction.email}</td>
                    <td>â‚¹${transaction.total}</td>
                    <td class="status-${transaction.status.toLowerCase()}">${transaction.status}</td>
                    <td>
                        ${transaction.status === 'Pending' ? 
                            `<button class="btn btn-success" onclick="confirmTransaction(${transaction.id})">Confirm</button>` : 
                            'Confirmed'}
                    </td>
                `;
                transactionsTable.appendChild(row);
            });
        }

        function confirmTransaction(transactionId) {
            // In a real app, this would update the database
            const transaction = transactions.find(t => t.id === transactionId);
            if (transaction) {
                transaction.status = 'Confirmed';
                renderTransactions();
                showNotification(`Transaction #${transactionId} confirmed`);
            }
        }

        // Utility functions
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = '#059669';
            notification.style.color = 'white';
            notification.style.padding = '1rem 1.5rem';
            notification.style.borderRadius = '8px';
            notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
            notification.style.zIndex = '1000';
            notification.style.animation = 'fadeIn 0.3s ease';
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function scrollToProducts() {
            document.getElementById('products-grid').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Render products on page load
            renderProducts();
            updateCartCount();
            
            // Handle view based on URL hash
            if (window.location.hash) {
                const viewName = window.location.hash.substring(1);
                showView(viewName);
            }
            
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                const errorElement = document.getElementById('login-error');
                
                if (loginUser(email, password)) {
                    errorElement.style.display = 'none';
                } else {
                    errorElement.textContent = 'Invalid email/username or password';
                    errorElement.style.display = 'block';
                }
            });
            
            // Register form submission
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('register-username').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                
                const errorElement = document.getElementById('register-error');
                const successElement = document.getElementById('register-success');
                
                // Basic validation
                if (password !== confirm) {
                    errorElement.textContent = 'Passwords do not match';
                    errorElement.style.display = 'block';
                    successElement.style.display = 'none';
                    return;
                }
                
                if (password.length < 6) {
                    errorElement.textContent = 'Password must be at least 6 characters';
                    errorElement.style.display = 'block';
                    successElement.style.display = 'none';
                    return;
                }
                
                const result = registerUser(username, email, password);
                
                if (result.success) {
                    errorElement.style.display = 'none';
                    successElement.textContent = result.message;
                    successElement.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('register-form').reset();
                    
                    // Redirect to login after 2 seconds
                    setTimeout(() => {
                        showView('login');
                    }, 2000);
                } else {
                    errorElement.textContent = result.message;
                    errorElement.style.display = 'block';
                    successElement.style.display = 'none';
                }
            });
            
            // Navigation links
            document.querySelectorAll('.nav-link[data-view]').forEach(link => {
                link.addEventListener('click', function(e) {
                    if (this.id !== 'auth-link') {
                        e.preventDefault();
                        showView(this.getAttribute('data-view'));
                    }
                });
            });
        });
    </script>
</body>
</html>